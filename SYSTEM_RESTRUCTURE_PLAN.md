# üìò ‡πÅ‡∏°‡πà‡∏ö‡∏ó‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (System Restructure Master Plan)

> **‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏°‡πà‡∏ö‡∏ó‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2**
>
> ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (‡∏Å‡∏£‡∏ì‡∏µ token ‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠ session ‡πÉ‡∏´‡∏°‡πà)

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á**: 27 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025
**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: üü° ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
**Progress**: Phase 0 - Planning Complete
**‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢**: AI Assistant (Claude)

---

## üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡πâ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô **2 ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å**:

1. **‡∏£‡∏∞‡∏ö‡∏ö (System)** - ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö (‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå, ‡πÄ‡∏ä‡πá‡∏Ñ, OCR, ‡∏Ø‡∏•‡∏Ø)
2. **Bplus** - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Bplus (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)

### ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:

- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ö‡∏ö Tree Structure (Parent-Child)
- ‚úÖ Drag & Drop ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏±‡∏ö Parent-Child
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Bplus)
- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
- ‚úÖ **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å created_by/updated_by ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á** ‚≠ê

---

## üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### ‡πÄ‡∏î‡∏¥‡∏° (Before)

```
sys_menus
‚îú‚îÄ‚îÄ department_id ‚Üí ‡πÅ‡∏¢‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å (‡∏ú‡∏¥‡∏î‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î)
‚îú‚îÄ‚îÄ parent_id
‚îî‚îÄ‚îÄ sort_order

‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π ‚Üí ‡∏°‡∏µ Tab ‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ, ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô, IT, ‡∏Ø‡∏•‡∏Ø)
Sidebar ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
```

### ‡πÉ‡∏´‡∏°‡πà (After)

```
sys_menus
‚îú‚îÄ‚îÄ system_type ‚Üí ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏£‡∏∞‡∏ö‡∏ö (1=System, 2=Bplus)
‚îú‚îÄ‚îÄ parent_id ‚Üí ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Tree Structure
‚îî‚îÄ‚îÄ sort_order ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö

sys_users
‚îú‚îÄ‚îÄ department_id ‚Üí user ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ú‡∏ô‡∏Å‡πÑ‡∏´‡∏ô
‚îú‚îÄ‚îÄ created_by ‚Üí ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á ‚≠ê
‚îî‚îÄ‚îÄ updated_by ‚Üí ‡∏ú‡∏π‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚≠ê

‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π ‚Üí ‡∏°‡∏µ 2 Tab: [‡∏£‡∏∞‡∏ö‡∏ö] [Bplus]
Sidebar ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå + ‡πÇ‡∏•‡πÇ‡∏Å‡πå‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
```

---

## üì¶ ‡∏™‡∏£‡∏∏‡∏õ 8 Phases

| Phase | ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡πÄ‡∏ß‡∏•‡∏≤ |
|-------|--------|-------|------|
| **Phase 1** | ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‚¨ú Pending | 30 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **Phase 2** | ‡∏õ‡∏£‡∏±‡∏ö Model ‡πÅ‡∏•‡∏∞ Logic | ‚¨ú Pending | 20 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **Phase 3** | ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π | ‚¨ú Pending | 20 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **Phase 4** | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó | ‚¨ú Pending | 40 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **Phase 5** | ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ | ‚¨ú Pending | 30 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **Phase 6** | ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‚¨ú Pending | 20 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **Phase 7** | ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Middleware & Sidebar | ‚¨ú Pending | 20 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **Phase 8** | Testing & Cleanup | ‚¨ú Pending | 20 ‡∏ô‡∏≤‡∏ó‡∏µ |

**‡∏£‡∏ß‡∏°**: ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2.5-3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á

---

## üîë ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å User (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!)

### Q1: ‡∏ä‡∏∑‡πà‡∏≠ field ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á sys_menus
**‡∏ï‡∏≠‡∏ö**: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ `department_id` ‚Üí `system_type`

### Q2: ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
**‡∏ï‡∏≠‡∏ö**: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A - Session (Login ‡πÉ‡∏´‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà)

### Q3: ‡πÄ‡∏°‡∏ô‡∏π "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô?
**‡∏ï‡∏≠‡∏ö**: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A - ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô Sidebar + ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà Sidebar Header

### Q4: ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ User ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
**‡∏ï‡∏≠‡∏ö**: ‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß (`admin/users` + `admin/user-approvals`) ‚Üí ‡∏£‡∏ß‡∏° 2 ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏´‡∏ô‡πâ‡∏≤ 2 tabs

### Q5: ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
**‡∏ï‡∏≠‡∏ö**:
- ‡πÅ‡∏ú‡∏ô‡∏Å **Admin** ‚Üí ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡πÅ‡∏ú‡∏ô‡∏Å **User** ‚Üí ‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (default)
- ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‚Üí Admin ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á

### Q6: Migration ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
**‡∏ï‡∏≠‡∏ö**: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏° Q1 ‡πÅ‡∏•‡∏∞‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏° `connection_type`:
- `connection_type = 'pgsql'` ‚Üí `system_type = 1` (System)
- `connection_type = 'mysql'` ‚Üí `system_type = 2` (Bplus)

---

## üì¶ Phase 1: ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `department_id` ‚Üí `system_type` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `sys_menus`
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `department_id` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `sys_users`
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (System, Bplus, Admin, User)
- **‡πÄ‡∏û‡∏¥‡πà‡∏° `created_by` ‡πÅ‡∏•‡∏∞ `updated_by` ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á** ‚≠ê

### üìù Migrations ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á

#### 1. Rename department_id ‚Üí system_type

```php
// database/migrations/2025_10_27_100000_rename_department_id_to_system_type_in_menus.php

Schema::table('sys_menus', function (Blueprint $table) {
    $table->renameColumn('department_id', 'system_type');
});

// Migrate data based on connection_type
DB::table('sys_menus')->where('connection_type', 'pgsql')->update(['system_type' => 1]);
DB::table('sys_menus')->where('connection_type', 'mysql')->update(['system_type' => 2]);

// Update sys_departments
DB::table('sys_departments')->truncate();
DB::table('sys_departments')->insert([
    ['id' => 1, 'key' => 'system', 'label' => '‡∏£‡∏∞‡∏ö‡∏ö', 'sort_order' => 1],
    ['id' => 2, 'key' => 'bplus', 'label' => 'Bplus', 'sort_order' => 2],
    ['id' => 3, 'key' => 'admin', 'label' => 'Admin', 'sort_order' => 3],
    ['id' => 4, 'key' => 'user', 'label' => 'User', 'sort_order' => 4],
]);
```

#### 2. Add department_id to users

```php
// database/migrations/2025_10_27_100001_add_department_id_to_users.php

Schema::table('sys_users', function (Blueprint $table) {
    $table->unsignedBigInteger('department_id')->nullable()->after('email');
    $table->foreign('department_id')->references('id')->on('sys_departments')->onDelete('set null');
});

DB::table('sys_users')->update(['department_id' => 4]); // Default = User
```

#### 3. Add created_by/updated_by to ALL tables

```php
// database/migrations/2025_10_27_100002_add_user_tracking_to_all_tables.php

$tables = [
    'sys_menus', 'sys_menu_groups', 'sys_departments',
    'sys_department_menu_permissions', 'sys_user_menu_permissions',
    'sys_users', 'sys_user_company_access',
    'companies', 'branches', 'cheques', 'cheque_templates',
];

foreach ($tables as $table) {
    if (Schema::hasTable($table)) {
        Schema::table($table, function (Blueprint $table) {
            if (!Schema::hasColumn($table->getTable(), 'created_by')) {
                $table->unsignedBigInteger('created_by')->nullable()->after('created_at');
                $table->foreign('created_by')->references('id')->on('sys_users')->onDelete('set null');
            }
            if (!Schema::hasColumn($table->getTable(), 'updated_by')) {
                $table->unsignedBigInteger('updated_by')->nullable()->after('updated_at');
                $table->foreign('updated_by')->references('id')->on('sys_users')->onDelete('set null');
            }
        });
    }
}
```

### ‚úÖ Checklist Phase 1

- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á migration 100000 (rename department_id)
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á migration 100001 (add department_id to users)
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á migration 100002 (add created_by/updated_by)
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á DepartmentPermissionsSeeder
- [ ] ‡∏£‡∏±‡∏ô `php artisan migrate`
- [ ] ‡∏£‡∏±‡∏ô `php artisan db:seed --class=DepartmentPermissionsSeeder`

---

## üì¶ Phase 2: ‡∏õ‡∏£‡∏±‡∏ö Model ‡πÅ‡∏•‡∏∞ Logic

### üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Trait ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö auto-fill `created_by`/`updated_by`
- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Models ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Trait ‡∏ô‡∏µ‡πâ
- ‡πÄ‡∏û‡∏¥‡πà‡∏° Methods ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

### üìù Trait: HasUserTracking

```php
// app/Traits/HasUserTracking.php

namespace App\Traits;

trait HasUserTracking
{
    protected static function bootHasUserTracking()
    {
        static::creating(function ($model) {
            if (auth()->check()) {
                $model->created_by = auth()->id();
                $model->updated_by = auth()->id();
            }
        });

        static::updating(function ($model) {
            if (auth()->check()) {
                $model->updated_by = auth()->id();
            }
        });
    }

    public function creator()
    {
        return $this->belongsTo(\App\Models\User::class, 'created_by');
    }

    public function updater()
    {
        return $this->belongsTo(\App\Models\User::class, 'updated_by');
    }
}
```

### üìù Models ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Trait

```php
// ‡πÄ‡∏û‡∏¥‡πà‡∏° use HasUserTracking; ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ:

- app/Models/Menu.php
- app/Models/User.php
- app/Models/Department.php
- app/Models/Company.php
- app/Models/Branch.php
- app/Models/Cheque.php
- app/Models/ChequeTemplate.php
- app/Models/UserCompanyAccess.php
- app/Models/DepartmentMenuPermission.php
- app/Models/UserMenuPermission.php
- app/Models/MenuGroup.php
```

### üìù User Model: ‡πÄ‡∏û‡∏¥‡πà‡∏° Methods

```php
// app/Models/User.php

public function getAccessibleMenus()
{
    if (!$this->department_id) return collect([]);

    $departmentMenuIds = DepartmentMenuPermission::where('department_id', $this->department_id)
        ->pluck('menu_id');

    $userMenuIds = $this->userMenuPermissions()->pluck('menu_id');

    $allMenuIds = $departmentMenuIds->merge($userMenuIds)->unique();

    return Menu::whereIn('id', $allMenuIds)->active()->orderBy('sort_order')->get();
}

public function hasMenuAccess($routeName)
{
    $menu = Menu::where('route', $routeName)->first();
    if (!$menu) return true;

    return $this->getAccessibleMenus()->contains('id', $menu->id);
}

public function getAccessibleCompanies()
{
    return $this->companyAccess()->with('company')->get()->pluck('company');
}

public function hasAccessToCompany($companyId)
{
    return $this->companyAccess()->where('company_id', $companyId)->exists();
}

public function setCurrentCompany($companyId)
{
    if (!$this->hasAccessToCompany($companyId)) return false;

    session(['current_company' => Company::find($companyId)]);
    return true;
}
```

### ‚úÖ Checklist Phase 2

- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á HasUserTracking trait
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° trait ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å Model
- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó User model (methods)
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö create/update ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö created_by/updated_by

---

## üì¶ Phase 3: ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π

### üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Tab ‡∏à‡∏≤‡∏Å "‡πÅ‡∏ú‡∏ô‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÜ" ‚Üí "‡∏£‡∏∞‡∏ö‡∏ö" ‡πÅ‡∏•‡∏∞ "Bplus"
- ‡∏õ‡∏£‡∏±‡∏ö JavaScript ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö `system_type`

### üìù JavaScript Changes

```javascript
// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:
departments: @json($departments),
selectedDepartment: ...

// ‡πÄ‡∏õ‡πá‡∏ô:
systemTypes: [
    { id: 1, key: 'system', label: '‡∏£‡∏∞‡∏ö‡∏ö' },
    { id: 2, key: 'bplus', label: 'Bplus' }
],
selectedSystemType: 1,
```

### üìù HTML Changes

```html
<!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Department Tabs -->
<button onclick="menuManager.switchDepartment({{ $dept->id }})">

<!-- ‡πÄ‡∏õ‡πá‡∏ô System Type Tabs -->
<button onclick="menuManager.switchSystemType(1)">‡∏£‡∏∞‡∏ö‡∏ö</button>
<button onclick="menuManager.switchSystemType(2)">Bplus</button>
```

### ‚úÖ Checklist Phase 3

- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó MenuController
- [ ] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç JavaScript (department ‚Üí systemType)
- [ ] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç HTML (tabs)
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° field system_type ‡πÉ‡∏ô Modal Form
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö CRUD ‡πÄ‡∏°‡∏ô‡∏π

---

## üì¶ Phase 4: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó

### üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" ‡πÉ‡∏ô Sidebar (Bplus)
- ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πå‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà Sidebar Header
- Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
- ‡πÄ‡∏Å‡πá‡∏ö‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô Session

### üìù Files to Create/Edit

1. **Controller**: `app/Http/Controllers/CompanyController.php`
2. **Routes**: `routes/web.php`
3. **View**: `resources/views/components/company-switch-modal.blade.php`
4. **Sidebar**: `resources/views/tailadmin/partials/sidebar.blade.php`
5. **Seeder**: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"

### üìù Sidebar Header

```blade
@if(session('current_company'))
<div class="px-4 py-4 border-b">
    <div class="flex items-center gap-3">
        <img src="{{ session('current_company')->logo ?? '/default-logo.png' }}"
             class="w-12 h-12 rounded-lg">
        <div>
            <div class="text-sm font-semibold">{{ session('current_company')->name }}</div>
            <div class="text-xs text-gray-500">Bplus System</div>
        </div>
    </div>
</div>
@endif
```

### ‚úÖ Checklist Phase 4

- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á CompanyController
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Routes
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á Modal component
- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Sidebar (header + ‡πÄ‡∏°‡∏ô‡∏π)
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó

---

## üì¶ Phase 5: ‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

### üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡∏£‡∏ß‡∏° `admin/users` + `admin/user-approvals` ‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏´‡∏ô‡πâ‡∏≤ 2 tabs
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á

### üìù View Structure

```
‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
‚îú‚îÄ‚îÄ Tab 1: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îÇ   ‚îî‚îÄ‚îÄ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á: ‡∏ä‡∏∑‡πà‡∏≠, Email, ‡πÅ‡∏ú‡∏ô‡∏Å, ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
‚îî‚îÄ‚îÄ Tab 2: ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (badge ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô)
    ‚îî‚îÄ‚îÄ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á: ‡∏ä‡∏∑‡πà‡∏≠, Email, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£, [‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò]
```

### üìù User Registration

```php
// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà
$user->department_id = 4; // ‡πÅ‡∏ú‡∏ô‡∏Å "User" (default)
$user->is_approved = false; // ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
```

### ‚úÖ Checklist Phase 5

- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á View `admin/users.blade.php` (2 tabs)
- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UserController
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Routes
- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Registration logic
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå

---

## üì¶ Phase 6: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

### üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- Admin ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π
- User ‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (Bplus Dashboard)

### üìù Seeder

```php
// DepartmentPermissionsSeeder.php

// Admin (ID: 3) ‚Üí ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π
foreach (Menu::all() as $menu) {
    DepartmentMenuPermission::create([
        'department_id' => 3,
        'menu_id' => $menu->id
    ]);
}

// User (ID: 4) ‚Üí Bplus Dashboard
DepartmentMenuPermission::create([
    'department_id' => 4,
    'menu_id' => Menu::where('key', 'bplus_dashboard')->first()->id
]);
```

### ‚úÖ Checklist Phase 6

- [ ] ‡∏£‡∏±‡∏ô Seeder
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö sys_department_menu_permissions
- [ ] Login ‡πÄ‡∏õ‡πá‡∏ô Admin ‚Üí ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π
- [ ] Login ‡πÄ‡∏õ‡πá‡∏ô User ‚Üí ‡πÄ‡∏´‡πá‡∏ô 1 ‡πÄ‡∏°‡∏ô‡∏π

---

## üì¶ Phase 7: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Middleware & Sidebar

### üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- Middleware ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
- Sidebar ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

### üìù MenuPermission Middleware

```php
public function handle($request, Closure $next)
{
    $user = auth()->user();
    $routeName = $request->route()->getName();

    $menu = Menu::where('route', $routeName)->first();
    if (!$menu) return $next($request);

    if (!$user->hasMenuAccess($routeName)) {
        return redirect()->route('home')->with('forbidden', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå');
    }

    return $next($request);
}
```

### üìù Sidebar

```blade
@php
    $accessibleMenus = auth()->user()->getAccessibleMenus();
    $systemMenus = $accessibleMenus->where('system_type', 1);
    $bplusMenus = $accessibleMenus->where('system_type', 2);
@endphp

@if($systemMenus->count() > 0)
    <div>‡∏£‡∏∞‡∏ö‡∏ö</div>
    @foreach($systemMenus as $menu)
        <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π -->
    @endforeach
@endif

@if($bplusMenus->count() > 0)
    <div>Bplus</div>
    @foreach($bplusMenus as $menu)
        <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π -->
    @endforeach
@endif
```

### ‚úÖ Checklist Phase 7

- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó MenuPermission middleware
- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Sidebar
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á menu-item component
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

---

## üì¶ Phase 8: Testing & Cleanup

### ‚úÖ Testing Checklist

#### ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π
- [ ] ‡∏™‡∏•‡∏±‡∏ö Tab ‡∏£‡∏∞‡∏ö‡∏ö/Bplus
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π
- [ ] Drag & Drop ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö
- [ ] Drag & Drop ‡∏™‡∏•‡∏±‡∏ö parent-child
- [ ] Toggle ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö created_by/updated_by

#### ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
- [ ] ‡πÄ‡∏´‡πá‡∏ô‡πÇ‡∏•‡πÇ‡∏Å‡πå‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
- [ ] ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
- [ ] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‚Üí ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
- [ ] Logout ‚Üí Login ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà

#### ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- [ ] ‡πÄ‡∏´‡πá‡∏ô 2 tabs
- [ ] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç user (‡πÅ‡∏ú‡∏ô‡∏Å + ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó)
- [ ] ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
- [ ] ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÅ‡∏ú‡∏ô‡∏Å User

#### ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
- [ ] Admin ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π
- [ ] User ‡πÄ‡∏´‡πá‡∏ô‡∏ö‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π
- [ ] ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‚Üí redirect

### üßπ Cleanup

- [ ] ‡∏•‡∏ö view ‡πÄ‡∏Å‡πà‡∏≤ (card version)
- [ ] ‡∏•‡∏ö controller methods ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ
- [ ] Clear cache
- [ ] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó documentation

---

## üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

### Migrations (3 ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà)
1. `2025_10_27_100000_rename_department_id_to_system_type_in_menus.php`
2. `2025_10_27_100001_add_department_id_to_users.php`
3. `2025_10_27_100002_add_user_tracking_to_all_tables.php`

### Traits (1 ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà)
1. `app/Traits/HasUserTracking.php` ‚≠ê

### Models (11 ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
1. `app/Models/Menu.php`
2. `app/Models/User.php`
3. `app/Models/Department.php`
4. `app/Models/Company.php`
5. `app/Models/Branch.php`
6. `app/Models/Cheque.php`
7. `app/Models/ChequeTemplate.php`
8. `app/Models/UserCompanyAccess.php`
9. `app/Models/DepartmentMenuPermission.php`
10. `app/Models/UserMenuPermission.php`
11. `app/Models/MenuGroup.php`

### Controllers (3 ‡πÑ‡∏ü‡∏•‡πå)
1. `app/Http/Controllers/Admin/MenuController.php` (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
2. `app/Http/Controllers/Admin/UserController.php` (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
3. `app/Http/Controllers/CompanyController.php` ‚≠ê ‡πÉ‡∏´‡∏°‡πà

### Views (5 ‡πÑ‡∏ü‡∏•‡πå)
1. `resources/views/admin/menus-simple.blade.php` (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
2. `resources/views/admin/users.blade.php` ‚≠ê ‡πÉ‡∏´‡∏°‡πà
3. `resources/views/tailadmin/partials/sidebar.blade.php` (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
4. `resources/views/tailadmin/partials/menu-item.blade.php` ‚≠ê ‡πÉ‡∏´‡∏°‡πà
5. `resources/views/components/company-switch-modal.blade.php` ‚≠ê ‡πÉ‡∏´‡∏°‡πà

### Seeders (1 ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà)
1. `database/seeders/DepartmentPermissionsSeeder.php`

### Middleware (1 ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
1. `app/Http/Middleware/MenuPermission.php`

---

## üöÄ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô

```bash
# 1. Migrations
php artisan migrate

# 2. Seeders
php artisan db:seed --class=DepartmentPermissionsSeeder

# 3. Clear caches
php artisan view:clear
php artisan route:clear
php artisan config:clear
```

---

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

### üî• Breaking Changes
- `sys_menus.department_id` ‚Üí `sys_menus.system_type`
- `sys_departments` ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å truncate
- `sys_users` ‡πÄ‡∏û‡∏¥‡πà‡∏° field `department_id`

### üíæ Backup
- **Backup ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô migrate** (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)
- Session ‡∏Ç‡∏≠‡∏á user ‡∏à‡∏∞ reset
- User ‡∏ï‡πâ‡∏≠‡∏á logout ‡πÅ‡∏•‡∏∞ login ‡πÉ‡∏´‡∏°‡πà

### üí° Tips
- ‡πÉ‡∏ä‡πâ Git branch ‡πÅ‡∏¢‡∏Å
- Test ‡∏ö‡∏ô staging ‡∏Å‡πà‡∏≠‡∏ô
- ‡∏™‡∏£‡πâ‡∏≤‡∏á user ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å

---

## üìå ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á created_by/updated_by

### ‚≠ê ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ
```php
$table->unsignedBigInteger('created_by')->nullable();
$table->unsignedBigInteger('updated_by')->nullable();
$table->foreign('created_by')->references('id')->on('sys_users');
$table->foreign('updated_by')->references('id')->on('sys_users');
```

### ‚≠ê ‡∏ó‡∏∏‡∏Å Model ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Trait
```php
use HasUserTracking;
```

### ‚≠ê Auto-fill ‡πÄ‡∏°‡∏∑‡πà‡∏≠
- Create ‚Üí `created_by` = current user
- Update ‚Üí `updated_by` = current user

---

## üìû ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° Session ‡πÉ‡∏´‡∏°‡πà

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥:

1. ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
2. ‡∏ñ‡∏≤‡∏° User ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà Phase ‡πÑ‡∏´‡∏ô
3. ‡πÄ‡∏ä‡πá‡∏Ñ Checklist ‡∏Ç‡∏≠‡∏á Phase ‡∏ô‡∏±‡πâ‡∏ô
4. ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏ï‡∏≤‡∏° Phase

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ:

- **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå**: ‡πÅ‡∏¢‡∏Å‡πÄ‡∏°‡∏ô‡∏π 2 ‡∏£‡∏∞‡∏ö‡∏ö (System/Bplus)
- **‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡πÄ‡∏û‡∏¥‡πà‡∏° created_by/updated_by ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- **‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö User**: ‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å User"
- **‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£**: 8 Phases ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö

---

**üéâ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ AI Assistant - 27 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025**
